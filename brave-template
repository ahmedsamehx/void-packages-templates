# srcpkgs/brave-bin/template
pkgname=brave-bin
version=1.81.135
revision=1
only_for_archs="x86_64"
short_desc="Secure, fast and private web browser with ad blocker"
maintainer="Reback 00 <reback00@protonmail.com>"
license="MPL-2.0"
homepage="https://brave.com"

distfiles="https://github.com/brave/brave-browser/releases/download/v${version}/brave-browser_${version}_amd64.deb"
checksum=33df4b1743dcef8c6c4269c7f7b013094c6b03215f890d11c3c29822f909a0f7

hostmakedepends="binutils tar xz"
nostrip=yes

# اختياري: تبعيات زمن التشغيل الأساسية
#depends="libX11 libxss libXtst libXScrnSaver nss libXrandr libXcursor"

do_extract() {
    mkdir -p ${DESTDIR}
    ar x ${XBPS_DISTDIR}/distfiles/brave-browser_${version}_amd64.deb

    if [ -f data.tar.xz ]; then
        tar -xJf data.tar.xz
    elif [ -f data.tar.gz ]; then
        tar -xzf data.tar.gz
    else
        msg_error "unable to find data.tar.* inside .deb"
    fi
}

do_install() {
    install -d "${DESTDIR}/opt/brave.com/brave"
    cp -a "${wrksrc}/opt/brave.com/brave/"* "${DESTDIR}/opt/brave.com/brave/"

    # تنظيف ملفات غير ضرورية من /opt (اختياري)
    rm -rf "${DESTDIR}/etc" || true
    rm -rf "${DESTDIR}/opt/brave.com/brave/cron" || true

    # wrapper لتشغيل المتصفح مباشرة من PATH
    install -d "${DESTDIR}/usr/bin"
    cat > "${DESTDIR}/usr/bin/brave-browser" <<'EOF'
#!/bin/sh
exec /opt/brave.com/brave/brave "$@"
EOF
    chmod 0755 "${DESTDIR}/usr/bin/brave-browser"
}

